\chapter{Resultados}
\section{Propiedades de los sistemas de evaluación}
% ACA DEBERIA DECIR LAS CARACTERISTICAS DE LOS SISTEMAS Y CUALQUIER COSA DE LA EJECUCION QUE TENGA ALGO QUE VER CON EL SISTEMA QUE SE ESTÁ UTILIZANDO

Los tiempos de ejecuci\'on se midieron utilizando el reloj est\'andar de alta precisi\'on para Linux (\texttt{clock\_gettime}~\cite{LinuxDocumentation}), 


Claramente, el factor mas importante del sistema que afectará a la ejecución es el número total de partículas de éste. Los tamaños de sistemas utilizados fueron tres, y para 

Además del tamaño, hay otros factores del sistema que se tuvieron en cuenta para realizar una correcta evaluación y que deben ser 
Para tener en cuenta cualquier posible diferencia relacionada a los tipos de partículas, la asignación de tipos se hizo de forma aleatoria entre un total de 37 tipos existentes.

Además de las posiciones y tipos de particulas, es posible especificar velocidades iniciales....

En cuanto a los parámetros de ejecución se debe tener en cuenta que a medida que la simulación avanza, las partículas 
se deben tener en cuenta, entonces, dos aspectos que asocian la ejecucion con los parametros del sistema:
-las velocidades iniciales(ya descrito antes)
-el largo de la simulación y el uso de periocidad: es importante tener en cuenta que, si no se usa periodicidad, luego de cierto punto las particulas . 

Este efecto se verá en cualquier simulación independientemente de las propiedades del sistema inicial y, claramente es algo a tener en cuenta ya que afecta la correcta evaluación, la aproximación que usamos es aplicar condiciones periódicas de contorno en todas las simulaciones, independientemente del tamaño del sistema.
Al usar condiciones periodicas 
El tamaño de la caja es, entonces, otro factor importante . De esta forma, a menos que se especifique lo contraro, se define como tamaño de la caja al valor de cutoff/2.

Todos estos factores deben ser tenidos en cuenta a la hora de evaluar las implementaciones. 
, las situaciones mencionadas que afectan a la ejecucion sirven para demostrar propiedades de las implementaciones y como ejecuciones de control, para 
En las próximas secciones, cuando sea relevante, se especificarán las propiedades del sistema y de la ejecucion que se utilizaron.


\section{Performance}
Los sistemas detallados en la sección anterior se utilizaron para evaluar las distintas implementaciones en cuanto a performance..

\subsection{Evaluación de las implementaciones}

% PRIMER GRAFICO DEBERÍA IR EL TIEMPO DE EJECUCION DE LAS 3 IMPLEMENTACIONES PARA LOS DISTINTOS SISTEMAS (PERIODICO)
% GRAFICO DE BARRA CON LAS 3 IMPLEMENTACIONES AGRUPADAS EN 3(O 2) SISTEMAS DE PRUEBAS **PERIODICO -  CANTIDAD FIJA DE PASOS*
% *****PUEDO METER LO DE CPU TAMBIEN ACA  ****

En la figura \ref{time-compare} se puede ver los resultados en tiempo evaluados para todas las implementaciones detalladas en el capítulo previo.
Las evaluaciones miden el tiempo de ejecución del paso correspondiente al cálculo de fuerzas.



\begin{figure}[htbp]
\centering
   \includegraphics[width=\plotwidth]{plots/performance/comparacion-tiempos-sistemas.png}
 \caption{Comparaci\'on para los tres casos de prueba estudiados para las distintas implementaciones evaluadas}
 \label{time-compare}
\end{figure}


En la figura \ref{time-compare-cpu}


\begin{figure}[htbp]
\centering
   \includegraphics[width=\plotwidth]{plots/performance/comparacion-tiempos-TODOScpu.png}
 \caption{Comparaci\'on para los tres casos de prueba estudiados y la versión implementada sobre CPU para las distintas implementaciones evaluadas}
 \label{time-compare-cpu}
\end{figure}

\subsubsection{Efectos de la periodicidad}


% DESPUES EXPLICAR COMO AFECTA LA (NO)PERIODICIAD A LA EJECUCION Y MOSTRA EL GRAFICO DE TIEMPO DE EJECUCION DE LAS 3 IMPLEMENTACIONES PARA LOS DISTINTOS SISTEMAS (***NO** PERIODICO)
% DEBERIA MOSTRAR UN GRAFICO QUE DE ALGUNA FORMA COMPARE LAS IMPLEMENTACIONES PARA 1 SOLA ITERACION Y PARA UN NUMERO X DE ITERACIONES (PERIODICO con max. cutoff Y NO PERIODICO) 
% Y DECIR QUE A MEDIDA QUE SE EJECUTA, LOS ATOMOS SE 'ESCAPAN' DE LA CAJA NO PERIODICA PERO LA EJECUCION PERIODICA SIEMPRE MANTIENE EL NUMERO DE ATOMOS SOBRE LOS CUALES CALCULAR LA FUERZA
En la figura \ref{periodic-effects} se ven los efectos mencionados. Se muestra la ejecución de las diferentes implementaciones para un mismo sistema(X átomos). 
A partir de las distintas ejecuciones se calcularon los tiempos promedios por iteración. 
Se ve que en el caso de tener condiciones no periódicas, al evolucionar la ejecución la expansión del sistema disminuye el número de particulas que se encuentran dentro del radio definido por el cutoff.
Esto genera una disminución en el numero de interacciones que se deben calcular y por lo tanto se reduce el tiempo promedio por iteración. 
En otras condiciones iniciales, o para diferrentes sistemas de interacción, el tiempo promedio podría aumentar.

En el caso de condiciones periódicas(usando el cutoff máximo), todas las partículas del sistema se mantienen dentro del radio de iteracción y por lo tanto el número de 

\begin{figure}[htbp]
\centering
\begin{subfigure}[b]{\plotwidthtres}
   \includegraphics[width=\textwidth]{plots/NOperiodic/comparacion-NOperiodico.png}
   \caption{Condiciones no periódicas}
   \label{compar-1iter}
 \end{subfigure}
\begin{subfigure}[b]{\plotwidthtres}
   \includegraphics[width=\textwidth]{plots/NOperiodic/comparacion-periodico.png}
   \caption{Condiciones periódicas}
   \label{compar-niter}
 \end{subfigure}
 \caption{Comparaci\'on de tiempos de ejecuci\'on promedio por iteración para condiciones periódicas y no periódicas}
 \label{periodic-effects}
\end{figure}


\subsubsection{Efectos del cutoff}
Se realiza una evaluación del efecto del cutoff en el tiempo de ejecución
% GRAFICO SCATTER DE LAS 3 IMPLEMENTACIONES vs AUMENTO EN EL CUTOFF 
En la figura \ref{time-vs-cut} se ve el efecto del cutoff sobre el tiempo de ejecución del cálculo de fuerzas de interacción.

% \begin{figure}[htbp]
% \centering
%    \includegraphics[width=\plotwidth]{plots/timeVsCut/timeComparison.png}
%  \caption{Comparaci\'on de las distintas implementaciones sobre un sistema de 8000 átomos}
%  \label{time-vs-cut}
% \end{figure}


% MOSTRAR LO MISMO PARA LOS 3 SISTEMAS  **** TANTO PARA PERIODIC COMO NO PERIODIC****, ASI TAMBIEN SE VE EL EFECTO DEL CUTOFF EN EL TIEMPO PARA LOS CASOS PERIOD Y NO
\begin{figure}[htbp]
\centering
\begin{subfigure}[b]{\plotwidthtres}
   \includegraphics[width=\textwidth]{plots/timeVsCut/timeComparison-periodic.png}
   \caption{Condiciones de periodicidad}
   \label{compar-1iter}
 \end{subfigure}
\begin{subfigure}[b]{\plotwidthtres}
   \includegraphics[width=\textwidth]{plots/timeVsCut/timeComparison-NOperiodic.png}
   \caption{Condiciones NO periódicas}
   \label{compar-niter}
 \end{subfigure}
 \caption{Comparaci\'on de tiempos de ejecuci\'on bajo condiciones de periodicidad y NO-periódicas}
 \label{time-vs-cut}
\end{figure}


\subsection{Efectos del tamaño de bloque}

En la figura \ref{blockSize} se ve el efecto de la variación en el tamaño de los bloques para las distintas implementaciones.

En la implementación

\begin{figure}[htbp]
\centering
\begin{subfigure}[b]{\plotwidthtres}
   \includegraphics[width=\textwidth]{plots/blockSize/timeComparison-Analitic.png}
   \caption{Implementación base}
   \label{fig:cpu-scalability-caroteno}
 \end{subfigure}
\begin{subfigure}[b]{\plotwidthtres}
   \includegraphics[width=\textwidth]{plots/blockSize/timeComparison-Potential.png}
   \caption{implementación Tabla de potencial}
   \label{fig:cpu-scalability-fullereno}
 \end{subfigure}
\begin{subfigure}[b]{\plotwidthtres}
   \includegraphics[width=\textwidth]{plots/blockSize/timeComparison-Derivative.png}
   \caption{Implementación Tabla de derivadas}
   \label{fig:cpu-scalability-hemo}
 \end{subfigure}
 \caption{Efectos de la variación en los tamaños de bloque para las distintas implementaciones.}
 \label{blockSize}
\end{figure}


\section{Calidad numérica}

\subsection{Tamaños y límites de las tablas}
% GRAFICO DE ERROR ABSOLUTO vs NUMERO TOTAL DE ELEMENTOS DE LA TABLA
En la figura \ref{errorAbsElemTabla} se ven los errores asociados a un número muy chico de elementos en la tabla. 
Se ve como, para el caso de una tabla de potenciales, el error es mayor que la implementacion con tabla de derivadas
para un mismo numero de elementos.

\begin{figure}[htbp]
\centering
   \includegraphics[width=\plotwidth]{plots/erroresTabla/errorAbsolutoElemTabla.png}
 \caption{Comparaci\'on de las distintas implementaciones que utilizan tablas sobre un sistema de 8000 átomos }
 \label{errorAbsElemTabla}
\end{figure}





En la tabla \ref{tabla-errorRelativo-fuerzas} se muestran los errores relativos en el cálculo de fuerzas de las distintas implementaciones.
% EL ERROR ES EL PROMEDIO?? EL MAXIMO???
% QUE TAMAÑO DE TABLA SE USÓ??? 



En la tabla \ref{tabla-errorRelativo-potencial} se muestran los errores relativos en el cálculo de fuerzas de las distintas implementaciones.
% EL ERROR ES EL PROMEDIO?? EL MAXIMO???
% QUE TAMAÑO DE TABLA SE USÓ???  


% **************************************************
% ACA DEBERIA PONER LAS TABLAS CON ERRORES RELATIVOS
% *************************************************



\begin{table}[h]

\begin{minipage}{\linewidth}
\centering
\begin{tabular}{@{}llll@{}}

Error relativo(Fuerza)	 & 200 átomos            	& 8000 átomos        		& 20000 átomos \\ \bottomrule 
% Error relativo(Fuerza)	 &            			&      				& 		 \\ \hline
Implementación 1	 & 1.00E-09 			& 1.00E-09 			& 	-----	 \\ \hline
Implementación 2	 & 0.0003			& 0.0003			& 	-----	\\ \hline
Implementación 3	 & 8.00E-06 			& 8.00E-06			& 		 

\end{tabular}
\caption{Errores relativos en el cálculo de fuerzas para las distintas implementaciones y distintos tamaños de sistemas}
\label{tabla-errorRelativo-fuerzas}
\end{minipage}

\begin{minipage}{\linewidth}
\centering
\begin{tabular}{@{}llll@{}}
\\
\\
% Error relativo(E. Potencial)	 &		           	& 		       		& 		 \\ \bottomrule 
Error relativo(E. Potencial)	 & 200 átomos            	& 8000 átomos        		& 20000 átomos \\ \bottomrule 
Implementación 1	 & 1.00E-09 			& 1.00E-09 			& 		 \\ \hline
Implementación 2	 & 3.00E-05 			& 3.00E-04			&  		\\ \hline
Implementación 3	 & 3.00E-05	 		& 3.00E-04 			& 		 \\ \bottomrule

\end{tabular}
\end{minipage}
\caption{Errores relativos en el cálculo de fuerzas para las distintas implementaciones y distintos tamaños de sistemas}
\label{tabla-errorRelativo-potencial}
\end{table}


% 
% \begin{minipage}{\linewidth}
% \centering
% \begin{tabular}{@{}llll@{}}
% \toprule
% % Error relativo		 & 200 átomos            	& 8000 átomos        		& 20000 átomos \\ \midrule
% Implementación 1	 & 1.00E-09 			& 1.00E-09 			& 		 \\ \hline
% Implementación 2	 & 3.00E-05 			& 3.00E-04			&  		\\ \hline
% Implementación 3	 & 3.00E-05	 		& 3.00E-04 			& 		 \\ \bottomrule
% \end{tabular}
% \end{minipage}


% 
% 
% 
% \begin{table}[h]
% \centering
% \begin{tabular}{@{}llll@{}}
% \toprule
% Error relativo		 & 200 átomos            	& 8000 átomos        		& 20000 átomos \\ \midrule
% Implementación 1	 & 1.00E-09 			& 1.00E-09 			& 		 \\ \hline
% Implementación 2	 & 3.00E-05 			& 3.00E-04			&  		\\ \hline
% Implementación 3	 & 3.00E-05	 		& 3.00E-04 			& 		 \\ \bottomrule
% \end{tabular}
% \caption{Errores relativos en el cálculo de la energía potencial total para las distintas implementaciones y distintos tamaños de sistemas}
% \label{tabla-errorRelativo-energia}
% \end{table}
% 


\subsubsection{Efectos del limite superior de la tabla}

\begin{figure}[htbp]
\centering
\begin{subfigure}[b]{\plotwidthtres}
   \includegraphics[width=\textwidth]{plots/erroresTabla/errorAbsolutoLimite200.png}
   \caption{Condiciones de periodicidad}
   \label{compar-1iter}
 \end{subfigure}
\begin{subfigure}[b]{\plotwidthtres}
   \includegraphics[width=\textwidth]{plots/erroresTabla/errorAbsolutoLimite8k.png}
   \caption{Condiciones NO periódicas}
   \label{compar-niter}
 \end{subfigure}
 \caption{Comparacion de efectos en el error del calculo de fuerzas para sistemas de distinto tamaño}
 \label{time-vs-cut}
\end{figure}





\subsection{Estabilidad de la simulación}
% GRAFICO
% Acá debería mostrar como la energia se mantiene constante cuando hago una simulacion larga (distintos valores de tamano de tabla	)


